!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],r):"object"==typeof exports?exports.Mnania=r(require("jQuery")):e.Mnania=r(e.jQuery)}(this,(e=>(()=>{"use strict";var r={975:e=>{function r(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,r){for(var n,t="",i=0,o=-1,a=0,f=0;f<=e.length;++f){if(f<e.length)n=e.charCodeAt(f);else{if(47===n)break;n=47}if(47===n){if(o===f-1||1===a);else if(o!==f-1&&2===a){if(t.length<2||2!==i||46!==t.charCodeAt(t.length-1)||46!==t.charCodeAt(t.length-2))if(t.length>2){var u=t.lastIndexOf("/");if(u!==t.length-1){-1===u?(t="",i=0):i=(t=t.slice(0,u)).length-1-t.lastIndexOf("/"),o=f,a=0;continue}}else if(2===t.length||1===t.length){t="",i=0,o=f,a=0;continue}r&&(t.length>0?t+="/..":t="..",i=2)}else t.length>0?t+="/"+e.slice(o+1,f):t=e.slice(o+1,f),i=f-o-1;o=f,a=0}else 46===n&&-1!==a?++a:a=-1}return t}var t={resolve:function(){for(var e,t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a;o>=0?a=arguments[o]:(void 0===e&&(e=process.cwd()),a=e),r(a),0!==a.length&&(t=a+"/"+t,i=47===a.charCodeAt(0))}return t=n(t,!i),i?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(r(e),0===e.length)return".";var t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!t)).length||t||(e="."),e.length>0&&i&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return r(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var i=arguments[n];r(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":t.normalize(e)},relative:function(e,n){if(r(e),r(n),e===n)return"";if((e=t.resolve(e))===(n=t.resolve(n)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var o=e.length,a=o-i,f=1;f<n.length&&47===n.charCodeAt(f);++f);for(var u=n.length-f,s=a<u?a:u,c=-1,l=0;l<=s;++l){if(l===s){if(u>s){if(47===n.charCodeAt(f+l))return n.slice(f+l+1);if(0===l)return n.slice(f+l)}else a>s&&(47===e.charCodeAt(i+l)?c=l:0===l&&(c=0));break}var d=e.charCodeAt(i+l);if(d!==n.charCodeAt(f+l))break;47===d&&(c=l)}var v="";for(l=i+c+1;l<=o;++l)l!==o&&47!==e.charCodeAt(l)||(0===v.length?v+="..":v+="/..");return v.length>0?v+n.slice(f+c):(f+=c,47===n.charCodeAt(f)&&++f,n.slice(f))},_makeLong:function(e){return e},dirname:function(e){if(r(e),0===e.length)return".";for(var n=e.charCodeAt(0),t=47===n,i=-1,o=!0,a=e.length-1;a>=1;--a)if(47===(n=e.charCodeAt(a))){if(!o){i=a;break}}else o=!1;return-1===i?t?"/":".":t&&1===i?"//":e.slice(0,i)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');r(e);var t,i=0,o=-1,a=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var f=n.length-1,u=-1;for(t=e.length-1;t>=0;--t){var s=e.charCodeAt(t);if(47===s){if(!a){i=t+1;break}}else-1===u&&(a=!1,u=t+1),f>=0&&(s===n.charCodeAt(f)?-1==--f&&(o=t):(f=-1,o=u))}return i===o?o=u:-1===o&&(o=e.length),e.slice(i,o)}for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){i=t+1;break}}else-1===o&&(a=!1,o=t+1);return-1===o?"":e.slice(i,o)},extname:function(e){r(e);for(var n=-1,t=0,i=-1,o=!0,a=0,f=e.length-1;f>=0;--f){var u=e.charCodeAt(f);if(47!==u)-1===i&&(o=!1,i=f+1),46===u?-1===n?n=f:1!==a&&(a=1):-1!==n&&(a=-1);else if(!o){t=f+1;break}}return-1===n||-1===i||0===a||1===a&&n===i-1&&n===t+1?"":e.slice(n,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,r){var n=r.dir||r.root,t=r.base||(r.name||"")+(r.ext||"");return n?n===r.root?n+t:n+"/"+t:t}(0,e)},parse:function(e){r(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var t,i=e.charCodeAt(0),o=47===i;o?(n.root="/",t=1):t=0;for(var a=-1,f=0,u=-1,s=!0,c=e.length-1,l=0;c>=t;--c)if(47!==(i=e.charCodeAt(c)))-1===u&&(s=!1,u=c+1),46===i?-1===a?a=c:1!==l&&(l=1):-1!==a&&(l=-1);else if(!s){f=c+1;break}return-1===a||-1===u||0===l||1===l&&a===u-1&&a===f+1?-1!==u&&(n.base=n.name=0===f&&o?e.slice(1,u):e.slice(f,u)):(0===f&&o?(n.name=e.slice(1,a),n.base=e.slice(1,u)):(n.name=e.slice(f,a),n.base=e.slice(f,u)),n.ext=e.slice(a,u)),f>0?n.dir=e.slice(0,f-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};t.posix=t,e.exports=t},786:r=>{r.exports=e}},n={};function t(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return r[e](o,o.exports,t),o.exports}t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};t.r(i),t.d(i,{checkSystemPath:()=>_,executeCommand:()=>T,focusWindow:()=>P,isSystemPath:()=>E,makeMnaniaFS:()=>k,makeWindowManager:()=>N,mkdir:()=>A,mnania:()=>I,mnaniaInstance:()=>j,normalizePath:()=>S,readdir:()=>C,resolveSymlink:()=>b,stat:()=>O,touch:()=>x,writeFile:()=>w});var o=t(975);function a(e){throw new Error(e)}var f=t(786);function u(e){return void 0===e?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==e&&void 0!==e.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:e.BS_PRIVATE_NESTED_SOME_NONE+1|0}:e}function s(e,r){if(r in e)return u(e[r])}function c(e,r){if(r>=0&&r<e.length)return u(e[r])}function l(e,r){return void 0!==e?function(e){if(null===e||void 0===e.BS_PRIVATE_NESTED_SOME_NONE)return e;var r=e.BS_PRIVATE_NESTED_SOME_NONE;return 0===r?void 0:{BS_PRIVATE_NESTED_SOME_NONE:r-1|0}}(e):r}function d(e){return void 0!==e}function v(e){return void 0===e}function h(e,r,n){var t=void 0!==e?e.h:0,i=void 0!==n?n.h:0;return{v:r,h:(t>=i?t:i)+1|0,l:e,r:n}}function m(e,r){return void 0===r||void 0!==e&&e.h>=r.h}function g(e,r,n){var t=void 0!==e?e.h:0,i=void 0!==n?n.h:0;if(t>(i+2|0)){var o=e.l,a=e.r;return m(o,a)?h(o,e.v,h(a,r,n)):h(h(o,e.v,a.l),a.v,h(a.r,r,n))}if(i<=(t+2|0))return{v:r,h:(t>=i?t:i)+1|0,l:e,r:n};var f=n.l,u=n.r;return m(u,f)?h(h(e,r,f),n.v,u):h(h(e,r,f.l),f.v,h(f.r,n.v,u))}function y(e,r){if(void 0===e)return function(e){return{v:e,h:1,l:void 0,r:void 0}}(r);var n=e.v;if(r===n)return e;var t=e.l,i=e.r;if(r<n){var o=y(t,r);return o===t?e:g(o,n,i)}var a=y(i,r);return a===i?e:g(t,n,a)}var p=function(e,r){for(;;){var n=e;if(void 0===n)return!1;var t=n.v;if(r===t)return!0;e=r<t?n.l:n.r}};function E(e){return["/dev","/.vfs_config","/dev/memory"].includes(e)}function b(e,r){for(var n=r;;){var t=n,i=s(e.symlinks,t);if(void 0===i)return t;if(p(void 0,i))throw a("Circular symbolic link");y(void 0,i),n=i}}function S(e,r){return"/".startsWith(r)?r:o.join(e.currentPath,r)}function _(e){if(E(e))throw a("Insufficient permissions: system paths cannot be modified")}function w(e,r,n){_(r);var t=S(e,r);e.files[b(e,t)]=n}function x(e,r){_(r);var n=b(e,S(e,r));if(v(s(e.files,n)))return w(e,n,"")}function A(e,r){_(r);var n=b(e,S(e,r));v(s(e.dirs,n))&&(e.dirs[n]=[])}function C(e,r){var n=b(e,r);return l(s(e.dirs,n),[])}function O(e,r){var n=b(e,r);return{isDirectory:function(){return d(s(e.dirs,n))},isFile:function(){return d(s(e.files,n))},isSymbolicLink:function(){return d(s(e.symlinks,r))},isExecutable:d(s(e.execlinks,r))?function(){return!0}:void 0,isSystem:E(r)}}function k(){var e={},r={},n={files:e,dirs:r,symlinks:{},execlinks:{},currentPath:"/dev/memory",systemPaths:["/dev","/.vfs_config","/dev/memory"]};r["/dev"]=["memory"],r["/dev/memory"]=[];return e["/.vfs_config"]=JSON.stringify({readOnlyPaths:["/dev","/.vfs_config","/dev/memory"],defaultPermissions:"rw",defaultFS:"/dev/memory"}),n}function N(){return{windows:[],topZIndex:1e3}}function P(e,r){e.topZIndex=e.topZIndex+1|0,r.element.css("z-index",String(e.topZIndex))}function T(e,r){var n=r.split(" "),t=c(n,0),i=c(n,1);if(void 0===t)throw a("Empty command");switch(t){case"ls":return C(e,l(i,e.currentPath));case"mkdir":if(void 0!==i)return A(e,i),[];throw a("mkdir: missing directory name");case"touch":if(void 0!==i)return x(e,i),[];throw a("touch: missing filename");default:throw a("Unknown command: "+t)}}var j={contents:void 0},I={start:function(e){f.jQuery(e).addClass("mnania-desktop");var r={fs:k(),wm:{windows:[],topZIndex:1e3}};return j.contents=r,r},executeCommand:T,createWindow:function(e,r){var n=f.jQuery(e);n.addClass("mnania-window");var t={id:r,element:n,zIndex:1e3};return n.on("mousedown",(function(){var e=j.contents;if(void 0!==e)return P(e.wm,t);throw a("Mnania not initialized")})),t}};return i})()));